import streamlit as st
import openai
from dotenv import load_dotenv
import os
from metadata import metadata
import streamlit as st
from PIL import Image

# 이미지 파일 로드
favicon = Image.open('images/favicon.png')

st.set_page_config(
    page_title="DB손해보험의 고객맞춤형 카드뉴스 문구 생성 AI",
    page_icon=favicon,
)



# Load environment variables
load_dotenv()

# Set up OpenAI API key
#openai.api_key = os.getenv("OPENAI_API_KEY")
openai.api_key = st.secrets["openai"]
def generate_prompt(age_group, job, household, region, scenario):
    age_data = metadata["A"][age_group]
    job_data = metadata["B"][job]
    household_data = metadata["C"][household]
    region_data = metadata["D"][region]
    scenario_data = metadata["E"][scenario]
    
    # 연령대별 프롬프트 기본 구조 가져오기
    age_specific_prompt = age_prompts[age_group]
    
    prompt = f"""
    당신은 ABC손해보험의 UX 라이팅 전문가입니다. 다음 고객 프로필과 특정 시나리오에 맞는 보험 관련 문자 메시지 카드뉴스를 작성해주세요:
    
    고객 프로필:
    - 연령대: {age_group} (키워드: {', '.join(age_data['키워드'])})
    - 직업: {job} (특성: {', '.join(job_data['특성'])})
    - 가구 형태: {household} (특성: {', '.join(household_data['특성'])})
    - 거주 지역: {region}
      특성: {', '.join(region_data['특성'])}
      니즈: {', '.join(region_data['니즈'])}
      관심사: {', '.join(region_data['관심사'])}
      주요 산업: {', '.join(region_data['주요_산업'])}
    
    특정 시나리오: {scenario}
    설명: {scenario_data['설명']}
    
    이 시나리오를 중심으로, 고객 프로필과 지역 특성에 맞춘 카드뉴스를 작성해주세요. 
    결과는 반드시 바로 고객에게 문자 메시지로 보내질 수 있는 수준으로, 어설픔이 전혀 없어야 하며, 마크다운 포맷 등에서 오류가 전혀 없어야만 합니다.
    
    다음 사항을 고려해주세요:
    1. {job}으로서의 니즈인 {', '.join(job_data['니즈'])}를 고려하세요.
    2. {household} 가구의 니즈인 {', '.join(household_data['니즈'])}에 맞춰주세요.
    3. {region} 지역의 특성을 반영하여 {', '.join(region_data['관심사'])}와 관련된 내용을 포함하세요.
    4. 보험 아이템 소개나 직접적인 보험 권유는 지양하고, 고객 프로필의 잠재적 리스크에 초점을 맞춰 데이터를 제공해주세요.
    5. 거주 지역은 간접적으로만 참고해주세요.
    
    {age_specific_prompt}
    
    ABC손해보험의 UX 라이팅 시스템을 따라 다음 원칙을 준수하여 작성해주세요:
    1. Clear (명확한): 복잡한 보험 용어를 피하고, 고객이 쉽게 이해할 수 있는 언어를 사용하세요.
    2. Concise (간결한): 핵심 메시지를 간결하게 전달하되, 필요한 정보는 충분히 제공하세요.
    3. Casual (친근한): 딱딱한 보험 회사 톤을 벗어나 친근하고 대화하는 듯한 톤을 사용하세요.
    4. Respect (존중하는): 고객의 상황을 존중하고, 선택권을 주는 표현을 사용하세요.
    5. Emotional (공감하는): 고객의 니즈와 감정에 공감하는 메시지를 포함하세요.
    
    추가 지침:
    - Predictable hint: 다음 단계나 행동을 예측할 수 있는 힌트를 제공하세요.
    - Focus on key message: 이 고객에게 가장 중요한 보험 관련 정보나 혜택을 선별하여 전달하세요.
    - Easy to speak: 대화체로 자연스럽게 읽히는 문장을 사용하세요.
    - Suggest than force: 강요하지 않고 고객이 스스로 선택할 수 있도록 제안하는 톤을 사용하세요.
    - Find hidden emotion: 특정 시나리오와 관련된 고객의 안전, 안정, 보호에 대한 감정을 고려하세요.
    
    카드뉴스 구성:
    1. 주의를 끄는 제목 (13단어 이내)
    2. 도입부: 특정 시나리오와 고객의 상황에 공감하는 1문장 (키워드 위주,15단어 이내)
    3. 핵심 내용: 
       - 이 시나리오와 고객에게 적합한 보험 상품이나 서비스 소개 (1개 항목, 키워드 위주, 각 11단어 이내)
       - 각 항목의 주요 혜택이나 특징 (각 키워드 위주,11단어 이내)
    4. 이 시나리오에서 고객에게 제공하는 가치나 해결할 수 있는 문제 설명 (키워드 위주,15단어 이내)
    5. 행동 유도 문구(CTA): 다음 단계를 안내하는 문장 (키워드 위주, 11단어 이내)
    
    반드시 전체 카드뉴스 내용은 80단어를 넘지 않도록 해주세요. 
    결과물은 사용자가 보게 됩니다. 따라서 절대로 카드뉴스 구성 포맷의 제목을 적지 말고 카드뉴스 최종 텍스트만 생성해주세요. 레이아웃을 모바일 환경에 특화하여 잘 고려해주세요.
    """
    
    return prompt


age_prompts = {
    "20대": """
    당신은 DB손해보험의 UX 라이팅 전문가입니다. 20대를 위한 보험 관련 문자 메시지 카드뉴스를 작성해주세요.
    트렌디해도 좋습니다. 힙한 반말도 가능합니다.
    
    고객 프로필:
    - 연령대: 20대 (키워드: {', '.join(metadata['A']['20대']['키워드'])})
    - 관심사: {', '.join(metadata['A']['20대']['관심사'])}
    - 재정 상태: {', '.join(metadata['A']['20대']['재정_상태'])}
    - 라이프스타일: {', '.join(metadata['A']['20대']['라이프스타일'])}
    - 보험 니즈: {', '.join(metadata['A']['20대']['보험_니즈'])}

    작성 시 다음 사항을 고려해주세요:
    1. MZ세대의 언어와 트렌드를 반영하세요. 최신 유행어나 밈을 적절히 활용하세요.
    2. 디지털 네이티브 특성을 고려하여 모바일 환경에 최적화된 내용을 작성하세요.
    3. 사회적 가치와 경험을 중시하는 20대의 특성을 반영하세요.
    4. 간결하고 직관적인 메시지로 핵심을 전달하세요.
    5. 이모티콘이나 해시태그를 적절히 활용하세요.
    6. FOMO(Fear of Missing Out)를 활용한 메시지를 포함하세요.

    카드뉴스 구성:
    1. 주의를 끄는 제목 (11단어 이내)
    2. 도입부: 20대의 상황에 공감하는 1문장 (17단어 이내)
    3. 핵심 내용: 
       - 이 연령대에 적합한 보험 상품이나 서비스 소개 (1개 항목, 키워드 위주 12단어 이내)
       - 각 항목의 주요 혜택이나 특징 (키워드 위주 10단어 이내)
    4. 20대에게 제공하는 가치나 해결할 수 있는 문제 설명 (15단어 이내)
    5. 행동 유도 문구(CTA): 다음 단계를 안내하는 키워드 위주 문장 (11단어 이내)

    전체 카드뉴스 내용은 80단어를 넘지 않도록 해주세요.
    """,

    "30대": """
    당신은 DB손해보험의 UX 라이팅 전문가입니다. 30대를 위한 보험 관련 문자 메시지 카드뉴스를 작성해주세요.
    
    고객 프로필:
    - 연령대: 30대 (키워드: {', '.join(metadata['A']['30대']['키워드'])})
    - 관심사: {', '.join(metadata['A']['30대']['관심사'])}
    - 재정 상태: {', '.join(metadata['A']['30대']['재정_상태'])}
    - 라이프스타일: {', '.join(metadata['A']['30대']['라이프스타일'])}
    - 보험 니즈: {', '.join(metadata['A']['30대']['보험_니즈'])}

    작성 시 다음 사항을 고려해주세요:
    1. 일과 삶의 균형, 가족에 대한 관심을 반영하세요.
    2. 경력 개발과 자기 계발에 대한 니즈를 고려하세요.
    3. 실용적이고 효율적인 정보를 제공하세요.
    4. 가족 형성과 주택 마련 등 30대의 주요 관심사를 반영하세요.
    5. 재테크와 자산 관리에 대한 정보를 포함하세요.
    6. 건강 관리와 스트레스 해소에 대한 내용을 다루세요.

    카드뉴스 구성:
    1. 주의를 끄는 제목 (11단어 이내)
    2. 도입부: 30대의 상황에 공감하는 1문장 (17단어 이내)
    3. 핵심 내용: 
       - 이 연령대에 적합한 보험 상품이나 서비스 소개 (1개 항목, 키워드 위주 12단어 이내)
       - 각 항목의 주요 혜택이나 특징 (키워드 위주  11단어 이내)
    4. 30대에게 제공하는 가치나 해결할 수 있는 문제 설명 (15단어 이내)
    5. 행동 유도 문구(CTA): 다음 단계를 안내하는 키워드 위주 문장 (11단어 이내)

    전체 카드뉴스 내용은 80단어를 넘지 않도록 해주세요.
    """,

    "40대": """
    당신은 DB손해보험의 UX 라이팅 전문가입니다. 40대를 위한 보험 관련 문자 메시지 카드뉴스를 작성해주세요.
    
    고객 프로필:
    - 연령대: 40대 (키워드: {', '.join(metadata['A']['40대']['키워드'])})
    - 관심사: {', '.join(metadata['A']['40대']['관심사'])}
    - 재정 상태: {', '.join(metadata['A']['40대']['재정_상태'])}
    - 라이프스타일: {', '.join(metadata['A']['40대']['라이프스타일'])}
    - 보험 니즈: {', '.join(metadata['A']['40대']['보험_니즈'])}

    작성 시 다음 사항을 고려해주세요:
    1. 자녀 교육과 노후 준비에 대한 관심을 반영하세요.
    2. 건강 관리와 가족 건강에 대한 중요성을 강조하세요.
    3. 재무 계획과 자산 관리에 대한 정보를 제공하세요.
    4. 경력 안정과 자기 계발에 대한 니즈를 고려하세요.
    5. 부모 부양과 관련된 고민을 다루세요.
    6. 일-삶 균형과 스트레스 관리에 대한 내용을 포함하세요.

    카드뉴스 구성:
    1. 주의를 끄는 제목 (11단어 이내)
    2. 도입부: 40대의 상황에 공감하는 1문장 (17단어 이내)
    3. 핵심 내용: 
       - 이 연령대에 적합한 보험 상품이나 서비스 소개 (1개 항목, 키워드 위주, 12단어 이내)
       - 각 항목의 주요 혜택이나 특징 (키워드 위주 ,15단어 이내)
    4. 40대에게 제공하는 가치나 해결할 수 있는 문제 설명 (키워드 위주 ,15단어 이내)
    5. 행동 유도 문구(CTA): 다음 단계를 안내하는 키워드 위주 문장 (11단어 이내)

    전체 카드뉴스 내용은 80단어를 넘지 않도록 해주세요.
    """,

    "50대": """
    당신은 DB손해보험의 UX 라이팅 전문가입니다. 50대를 위한 보험 관련 문자 메시지 카드뉴스를 작성해주세요.
    
    고객 프로필:
    - 연령대: 50대 (키워드: {', '.join(metadata['A']['50대']['키워드'])})
    - 관심사: {', '.join(metadata['A']['50대']['관심사'])}
    - 재정 상태: {', '.join(metadata['A']['50대']['재정_상태'])}
    - 라이프스타일: {', '.join(metadata['A']['50대']['라이프스타일'])}
    - 보험 니즈: {', '.join(metadata['A']['50대']['보험_니즈'])}

    작성 시 다음 사항을 고려해주세요:
    1. 은퇴 준비와 노후 생활에 대한 관심을 반영하세요.
    2. 건강 관리와 만성질환 예방에 대한 중요성을 강조하세요.
    3. 자산 관리와 의료비 증가에 대한 대비 방법을 제시하세요.
    4. 새로운 취미와 여가 활동에 대한 니즈를 고려하세요.
    5. 자녀 독립과 관련된 심리적, 경제적 변화를 다루세요.
    6. 사회 공헌과 의미 있는 삶에 대한 욕구를 반영하세요.

    카드뉴스 구성:
    1. 주의를 끄는 제목 (11단어 이내)
    2. 도입부: 50대의 상황에 공감하는 1문장 (17단어 이내)
    3. 핵심 내용: 
       - 이 연령대에 적합한 보험 상품이나 서비스 소개 (1개 항목, 키워드 위주 , 12단어 이내)
       - 각 항목의 주요 혜택이나 특징 (키워드 위주 , 12단어 이내)
    4. 50대에게 제공하는 가치나 해결할 수 있는 문제 설명 (키워드 위주 ,15단어 이내)
    5. 행동 유도 문구(CTA): 다음 단계를 안내하는 키워드 위주 문장 (11단어 이내)

    전체 카드뉴스 내용은 80단어를 넘지 않도록 해주세요.
    """,

    "60대 이상": """
    당신은 DB손해보험의 UX 라이팅 전문가입니다. 60대 이상을 위한 보험 관련 문자 메시지 카드뉴스를 작성해주세요.
    
    고객 프로필:
    - 연령대: 60대 이상 (키워드: {', '.join(metadata['A']['60대 이상']['키워드'])})
    - 관심사: {', '.join(metadata['A']['60대 이상']['관심사'])}
    - 재정 상태: {', '.join(metadata['A']['60대 이상']['재정_상태'])}
    - 라이프스타일: {', '.join(metadata['A']['60대 이상']['라이프스타일'])}
    - 보험 니즈: {', '.join(metadata['A']['60대 이상']['보험_니즈'])}

    작성 시 다음 사항을 고려해주세요:
    1. 건강한 노후와 의료 서비스에 대한 관심을 반영하세요.
    2. 여가 활동과 사회적 관계 유지의 중요성을 강조하세요.
    3. 연금 수입과 의료비 지출 증가에 대한 대비 방법을 제시하세요.
    4. 손주 돌봄과 가족과의 시간에 대한 니즈를 고려하세요.
    5. 노화 관련 질환과 일상 생활 유지능력에 대한 고민을 다루세요.
    6. 디지털 기술 적응에 대한 어려움과 해결 방안을 포함하세요.

    카드뉴스 구성:
    1. 주의를 끄는 제목 (11단어 이내)
    2. 도입부: 60대 이상의 상황에 공감하는 1문장 (17단어 이내)
    3. 핵심 내용: 
       - 이 연령대에 적합한 보험 상품이나 서비스 소개 (1개 항목, 키워드 위주, 12단어 이내)
       - 각 항목의 주요 혜택이나 특징 (키워드 위주 ,12단어 이내)
    4. 60대 이상에게 제공하는 가치나 해결할 수 있는 문제 설명 (키워드 위주 ,15단어 이내)
    5. 행동 유도 문구(CTA): 다음 단계를 안내하는 문장 (키워드 위주 , 11단어 이내)

    전체 카드뉴스 내용은 80단어를 넘지 않도록 해주세요.
    글자 크기를 크게 하고, 복잡한 용어는 피하며, 간결하고 명확한 문장을 사용하세요.
    """
}





def generate_card_news(prompt):
    response = openai.ChatCompletion.create(
        model="gpt-4o",
        messages=[
            {"role": "system", "content": "당신은 보험 회사 DB손해보험의 UX Writer이자 마케팅 전문가입니다."},
            {"role": "user", "content": prompt}
        ],
        max_tokens=500
    )
    return response.choices[0].message['content']

st.title('고객맞춤형 카드뉴스 문구 생성 AI')

age_group = st.selectbox('연령대', list(metadata["A"].keys()))
job = st.selectbox('직업', list(metadata["B"].keys()))
household = st.selectbox('가구 형태', list(metadata["C"].keys()))
region = st.selectbox('거주 지역', list(metadata["D"].keys()))

# 시나리오 선택 옵션 추가
scenario = st.selectbox('시나리오', list(metadata["E"].keys()))
#scenario = "휴가철 운전"
if st.button('카드뉴스 생성'):
    prompt = generate_prompt(age_group, job, household, region, scenario)
    with st.spinner('카드뉴스를 생성 중입니다...'):
        card_news = generate_card_news(prompt)
    st.subheader('생성된 카드뉴스')
    st.write(card_news)
    
    #st.subheader('사용된 프롬프트')
    #st.text(prompt)
